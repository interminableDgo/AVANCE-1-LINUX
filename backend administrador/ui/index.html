<!DOCTYPE html>
<html lang="es">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Administrador CRUD - Sistema de Monitoreo</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
	<style>
         :root {
             --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
             --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
             --success-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
             --warning-gradient: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
             --danger-gradient: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
             --card-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
             --card-shadow-hover: 0 16px 48px rgba(0, 0, 0, 0.12);
             --border-radius: 16px;
             --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
         }

         body {
             background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
             min-height: 100vh;
             font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
             color: #2d3748;
             line-height: 1.6;
         }

         .navbar {
             background: var(--primary-gradient);
             backdrop-filter: blur(20px);
             box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
             border: none;
             padding: 1rem 0;
         }

         .navbar-brand {
             font-weight: 700;
             font-size: 1.5rem;
             color: white !important;
             text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
         }

         .navbar-text {
             font-weight: 500;
             color: rgba(255, 255, 255, 0.9) !important;
         }

         .btn-outline-light {
             border: 2px solid rgba(255, 255, 255, 0.8);
             color: white;
             font-weight: 500;
             border-radius: 12px;
             padding: 0.75rem 1.5rem;
             transition: var(--transition);
             backdrop-filter: blur(10px);
         }

         .btn-outline-light:hover {
             background: rgba(255, 255, 255, 0.95);
             color: #667eea;
             transform: translateY(-2px);
             box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
         }

         .container {
             max-width: 1400px;
         }

         .stats-card {
             background: white;
             border: none;
             border-radius: var(--border-radius);
             box-shadow: var(--card-shadow);
             transition: var(--transition);
             overflow: hidden;
             position: relative;
         }

         .stats-card::before {
             content: '';
             position: absolute;
             top: 0;
             left: 0;
             right: 0;
             height: 4px;
             background: var(--primary-gradient);
         }

         .stats-card:hover {
             transform: translateY(-8px);
             box-shadow: var(--card-shadow-hover);
         }

         .stats-card .card-body {
             padding: 2rem 1.5rem;
             text-align: center;
         }

         .stats-card i {
             font-size: 2.5rem;
             background: var(--primary-gradient);
             -webkit-background-clip: text;
             -webkit-text-fill-color: transparent;
             background-clip: text;
             margin-bottom: 1rem;
         }

         .stats-number {
             font-size: 2.5rem;
             font-weight: 700;
             color: #2d3748;
             margin-bottom: 0.5rem;
         }

         .stats-card .small {
             color: #718096;
             font-weight: 500;
             font-size: 0.9rem;
         }

         .main-card {
             background: white;
             border: none;
             border-radius: var(--border-radius);
             box-shadow: var(--card-shadow);
             overflow: hidden;
         }

         .main-card .card-body {
             padding: 2rem;
         }

         .card-header-custom {
             background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
             border-bottom: 1px solid #e2e8f0;
             padding: 1.5rem 2rem;
             margin: -2rem -2rem 2rem -2rem;
         }

         .card-title {
             font-weight: 600;
             color: #2d3748;
             margin: 0;
             font-size: 1.25rem;
         }

         .btn {
             border-radius: 12px;
             font-weight: 500;
             padding: 0.75rem 1.5rem;
             transition: var(--transition);
             border: none;
         }

         .btn-success {
             background: var(--success-gradient);
             color: white;
         }

         .btn-success:hover {
             transform: translateY(-2px);
             box-shadow: 0 8px 25px rgba(79, 172, 254, 0.3);
         }

         .btn-primary {
             background: var(--primary-gradient);
             color: white;
         }

         .btn-primary:hover {
             transform: translateY(-2px);
             box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
         }

         .btn-outline-primary {
             border: 2px solid #667eea;
             color: #667eea;
             background: transparent;
         }

         .btn-outline-primary:hover {
             background: var(--primary-gradient);
             border-color: transparent;
             transform: translateY(-2px);
         }

         .btn-outline-info {
             border: 2px solid #4facfe;
             color: #4facfe;
             background: transparent;
         }

         .btn-outline-info:hover {
             background: var(--success-gradient);
             border-color: transparent;
             transform: translateY(-2px);
         }

         .btn-outline-danger {
             border: 2px solid #fa709a;
             color: #fa709a;
             background: transparent;
         }

         .btn-outline-danger:hover {
             background: var(--danger-gradient);
             border-color: transparent;
             transform: translateY(-2px);
         }

         .table {
             border-radius: 12px;
             overflow: hidden;
             box-shadow: 0 4px 16px rgba(0, 0, 0, 0.05);
         }

         .table th {
             background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
             border: none;
             font-weight: 600;
             color: #4a5568;
             padding: 1.25rem 1rem;
             font-size: 0.9rem;
             text-transform: uppercase;
             letter-spacing: 0.5px;
         }

         .table td {
             border: none;
             border-bottom: 1px solid #f1f5f9;
             padding: 1.25rem 1rem;
             vertical-align: middle;
         }

         .table tbody tr {
             transition: var(--transition);
         }

         .table tbody tr:hover {
             background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
             transform: scale(1.01);
         }

         .avatar-sm {
             width: 48px !important;
             height: 48px !important;
             background: var(--primary-gradient) !important;
             border-radius: 12px;
             display: flex;
             align-items: center;
             justify-content: center;
             font-size: 1.2rem;
             color: white;
             box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
         }

         .badge {
             padding: 0.5rem 1rem;
             border-radius: 20px;
             font-weight: 500;
             font-size: 0.8rem;
             text-transform: uppercase;
             letter-spacing: 0.5px;
         }

         .badge-patient {
             background: linear-gradient(135deg, #e2e8f0 0%, #cbd5e0 100%);
             color: #4a5568;
             border: 1px solid #e2e8f0;
         }

         .badge-admin {
             background: var(--primary-gradient);
             color: white;
         }

         .btn-group .btn {
             padding: 0.5rem;
             margin: 0 0.25rem;
             border-radius: 8px;
             min-width: 40px;
         }

         .modal-content {
             border: none;
             border-radius: var(--border-radius);
             box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
         }

         .modal-header {
             background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
             border-bottom: 1px solid #e2e8f0;
             border-radius: var(--border-radius) var(--border-radius) 0 0;
         }

         .modal-title {
             font-weight: 600;
             color: #2d3748;
         }

         .form-control, .form-select {
             border-radius: 12px;
             border: 2px solid #e2e8f0;
             padding: 0.875rem 1rem;
             font-size: 0.95rem;
             transition: var(--transition);
             background: #f8fafc;
         }

         .form-control:focus, .form-select:focus {
             border-color: #667eea;
             box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
             background: white;
             outline: none;
         }

         .form-label {
             font-weight: 500;
             color: #4a5568;
             margin-bottom: 0.5rem;
         }

         .toast {
             border: none;
             border-radius: 12px;
             box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
         }

         .bg-success {
             background: var(--success-gradient) !important;
         }

         .bg-danger {
             background: var(--danger-gradient) !important;
         }

         .text-muted {
             color: #718096 !important;
         }

         /* Animaciones */
         @keyframes fadeInUp {
             from {
                 opacity: 0;
                 transform: translateY(30px);
             }
             to {
                 opacity: 1;
                 transform: translateY(0);
             }
         }

         .stats-card, .main-card {
             animation: fadeInUp 0.6s ease-out;
         }

         .stats-card:nth-child(1) { animation-delay: 0.1s; }
         .stats-card:nth-child(2) { animation-delay: 0.2s; }
         .stats-card:nth-child(3) { animation-delay: 0.3s; }
         .main-card { animation-delay: 0.4s; }

         /* Responsive */
         @media (max-width: 768px) {
             .container {
                 padding: 0 1rem;
             }
             
             .stats-card .card-body {
                 padding: 1.5rem 1rem;
             }
             
             .main-card .card-body {
                 padding: 1.5rem;
             }
             
             .btn {
                 padding: 0.625rem 1.25rem;
                 font-size: 0.9rem;
             }
         }
	</style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-dark navbar-expand-lg">
		<div class="container">
            <a class="navbar-brand" href="#">
                <i class="fas fa-shield-alt me-3"></i>
                Panel Administrador
            </a>
            <div class="navbar-nav ms-auto">
                <span class="navbar-text me-4">
                    <i class="fas fa-database me-2"></i>
                    Sistema de Monitoreo
                </span>
                <button class="btn btn-outline-light" onclick="cerrarSesion()">
                    <i class="fas fa-sign-out-alt me-2"></i>
                    Cerrar Sesión
                </button>
            </div>
		</div>
	</nav>

	<div class="container my-5">
        <!-- Estadísticas -->
        <div class="row mb-5">
            <div class="col-md-4 mb-4">
                <div class="card stats-card">
                    <div class="card-body">
                        <i class="fas fa-users"></i>
                        <div class="stats-number" id="totalUsers">-</div>
                        <div class="small">Total Usuarios</div>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-4">
                <div class="card stats-card">
                    <div class="card-body">
                        <i class="fas fa-user"></i>
                        <div class="stats-number" id="totalPatients">-</div>
                        <div class="small">Pacientes</div>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-4">
                <div class="card stats-card">
                    <div class="card-body">
                        <i class="fas fa-user-shield"></i>
                        <div class="stats-number" id="totalAdmins">-</div>
                        <div class="small">Administradores</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Panel Principal -->
		<div class="card main-card">
			<div class="card-body">
                <div class="card-header-custom">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="card-title">
                            <i class="fas fa-users me-3"></i>
                            Gestión de Usuarios
                        </h5>
                        <div>
                            <button class="btn btn-success me-3" onclick="showCreateModal()">
                                <i class="fas fa-plus me-2"></i>Nuevo Usuario
                            </button>
                            <button class="btn btn-primary" onclick="loadUsers()">
                                <i class="fas fa-rotate me-2"></i>Actualizar
                            </button>
                        </div>
                    </div>
				</div>

                <!-- Tabla de Usuarios -->
				<div class="table-responsive">
					<table class="table table-hover" id="usersTable">
						<thead>
							<tr>
                                <th>Usuario</th>
								<th>Email</th>
								<th>Rol</th>
								<th>Género</th>
                                <th>Fecha Nacimiento</th>
								<th>Acciones</th>
							</tr>
						</thead>
                        <tbody id="usersTableBody">
                            <!-- Los usuarios se cargarán aquí -->
                        </tbody>
					</table>
				</div>
			</div>
		</div>
	</div>

    <!-- Modal para Crear/Editar Usuario -->
    <div class="modal fade" id="userModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalTitle">Nuevo Usuario</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="userForm">
                        <input type="hidden" id="patientId" name="patient_id">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="name" class="form-label">Nombre Completo *</label>
                                <input type="text" class="form-control" id="name" name="name" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="email" class="form-label">Email *</label>
                                <input type="email" class="form-control" id="email" name="email" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="dateOfBirth" class="form-label">Fecha de Nacimiento</label>
                                <input type="date" class="form-control" id="dateOfBirth" name="date_of_birth">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="gender" class="form-label">Género</label>
                                <select class="form-select" id="gender" name="gender">
                                    <option value="">Seleccionar...</option>
                                    <option value="Masculino">Masculino</option>
                                    <option value="Femenino">Femenino</option>
                                    <option value="Prefiero no decirlo">Prefiero no decirlo</option>
                                    <option value="Otro">Otro</option>
                                </select>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="password" class="form-label">Contraseña *</label>
                                <input type="password" class="form-control" id="password" name="password" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="rolAccount" class="form-label">Rol de Cuenta *</label>
                                <select class="form-select" id="rolAccount" name="rol_account" required>
                                    <option value="">Seleccionar...</option>
                                    <option value="Usuario">Usuario</option>
                                    <option value="Administrador">Administrador</option>
                                </select>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="medicalHistory" class="form-label">Historial Médico</label>
                            <textarea class="form-control" id="medicalHistory" name="medical_history" rows="3" placeholder="Describe el historial médico..."></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" onclick="saveUser()">
                        <i class="fas fa-save me-2"></i>Guardar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Confirmación para Eliminar -->
    <div class="modal fade" id="deleteModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Confirmar Eliminación</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p>¿Estás seguro de que quieres eliminar al usuario <strong id="deleteUserName"></strong>?</p>
                    <p class="text-danger small">Esta acción no se puede deshacer.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-danger" onclick="confirmDelete()">
                        <i class="fas fa-trash me-2"></i>Eliminar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast para Notificaciones -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3">
        <div id="notificationToast" class="toast" role="alert">
            <div class="toast-header">
                <i class="fas fa-info-circle me-2"></i>
                <strong class="me-auto" id="toastTitle">Notificación</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
            </div>
            <div class="toast-body" id="toastMessage"></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
	<script>
        let currentUser = null;
        let users = [];

        // Inicialización
        document.addEventListener('DOMContentLoaded', function() {
            loadUsers();
        });

        // Cargar usuarios
        async function loadUsers() {
            try {
                const response = await fetch('/api/users');
                if (!response.ok) throw new Error('Error al cargar usuarios');
                
                const data = await response.json();
                users = data.users || [];
                
                // Debug: mostrar datos en consola
                console.log('Datos de usuarios recibidos:', users);
                users.forEach((user, index) => {
                    console.log(`Usuario ${index + 1}:`, {
                        name: user.name,
                        email: user.email,
                        rol_account: user.rol_account,
                        gender: user.gender
                    });
                });
                
                displayUsers(users);
                updateStats(users);
                showNotification('Usuarios cargados exitosamente', 'success');
            } catch (error) {
                console.error('Error:', error);
                showNotification('Error al cargar usuarios: ' + error.message, 'error');
            }
        }

        // Mostrar usuarios en la tabla
        function displayUsers(users) {
            const tbody = document.getElementById('usersTableBody');
			tbody.innerHTML = '';

            users.forEach(user => {
				const tr = document.createElement('tr');
				tr.innerHTML = `
                    <td>
                        <div class="d-flex align-items-center">
                            <div class="avatar-sm">
                                <i class="fas fa-user"></i>
                            </div>
                            <div class="ms-3">
                                <strong>${user.name || 'Sin nombre'}</strong>
                                <div class="text-muted small">ID: ${user.patient_id}</div>
                            </div>
                        </div>
                    </td>
                    <td>${user.email || '-'}</td>
                    <td>
                        <span class="badge badge-${getRoleClass(user.rol_account)}">
                            ${formatRole(user.rol_account)}
                        </span>
                    </td>
                    <td>${formatGender(user.gender)}</td>
                    <td>${formatDate(user.date_of_birth)}</td>
                    <td>
                        <div class="btn-group" role="group">
                            <button class="btn btn-sm btn-outline-primary" onclick="editUser('${user.patient_id}')" title="Editar">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-info" onclick="viewUserData('${user.patient_id}')" title="Ver Datos">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-danger" onclick="deleteUser('${user.patient_id}', '${user.name}')" title="Eliminar">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
					</td>
				`;
				tbody.appendChild(tr);
			});
		}

        // Actualizar estadísticas
        function updateStats(users) {
            document.getElementById('totalUsers').textContent = users.length;
            document.getElementById('totalPatients').textContent = users.filter(u => u.rol_account === 'Usuario').length;
            document.getElementById('totalAdmins').textContent = users.filter(u => u.rol_account === 'Administrador').length;
        }

        // Mostrar modal de creación
        function showCreateModal() {
            currentUser = null;
            document.getElementById('modalTitle').textContent = 'Nuevo Usuario';
            document.getElementById('userForm').reset();
            document.getElementById('patientId').value = '';
            document.getElementById('password').required = true;
            new bootstrap.Modal(document.getElementById('userModal')).show();
        }

        // Editar usuario
        function editUser(patientId) {
            const user = users.find(u => u.patient_id === patientId);
            if (!user) return;

            currentUser = user;
            document.getElementById('modalTitle').textContent = 'Editar Usuario';
            document.getElementById('patientId').value = user.patient_id;
            document.getElementById('name').value = user.name || '';
            document.getElementById('email').value = user.email || '';
            document.getElementById('dateOfBirth').value = user.date_of_birth ? user.date_of_birth.split('T')[0] : '';
            document.getElementById('gender').value = user.gender || '';
            document.getElementById('rolAccount').value = user.rol_account || '';
            document.getElementById('medicalHistory').value = user.medical_history || '';
            document.getElementById('password').required = false;
            document.getElementById('password').placeholder = 'Dejar vacío para mantener la actual';

            new bootstrap.Modal(document.getElementById('userModal')).show();
        }

        // Guardar usuario
        async function saveUser() {
            const form = document.getElementById('userForm');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }

            const formData = new FormData(form);
            const userData = Object.fromEntries(formData);

            // Debug: mostrar datos que se van a enviar
            console.log('Datos del formulario:', userData);

            // Si es edición y no hay contraseña, remover el campo
            if (currentUser && !userData.password) {
                delete userData.password;
            }

            // Si es un nuevo usuario, generar UUID para patient_id
            if (!currentUser) {
                userData.patient_id = generateUUID();
                console.log('UUID generado:', userData.patient_id);
            }

            // Debug: mostrar datos finales
            console.log('Datos finales a enviar:', userData);

            try {
                const url = currentUser ? `/api/users/${currentUser.patient_id}` : '/api/users';
                const method = currentUser ? 'PUT' : 'POST';

                console.log('URL:', url, 'Método:', method);

                const jsonBody = JSON.stringify(userData);
                console.log('JSON enviado:', jsonBody);
                
                const response = await fetch(url, {
                    method: method,
                    headers: { 'Content-Type': 'application/json' },
                    body: jsonBody
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('Respuesta del servidor:', response.status, errorText);
                    throw new Error(`Error ${response.status}: ${errorText}`);
                }

                const result = await response.json();
                showNotification(result.message || 'Usuario guardado exitosamente', 'success');
                
                bootstrap.Modal.getInstance(document.getElementById('userModal')).hide();
                loadUsers();
            } catch (error) {
                console.error('Error completo:', error);
                showNotification('Error al guardar usuario: ' + error.message, 'error');
            }
        }

        // Eliminar usuario
        function deleteUser(patientId, userName) {
            currentUser = { patient_id: patientId };
            document.getElementById('deleteUserName').textContent = userName;
            new bootstrap.Modal(document.getElementById('deleteModal')).show();
        }

        // Confirmar eliminación
        async function confirmDelete() {
            try {
                const response = await fetch(`/api/users/${currentUser.patient_id}`, {
                    method: 'DELETE'
                });

                if (!response.ok) throw new Error('Error al eliminar usuario');

                const result = await response.json();
                showNotification(result.message || 'Usuario eliminado exitosamente', 'success');
                
                bootstrap.Modal.getInstance(document.getElementById('deleteModal')).hide();
                loadUsers();
            } catch (error) {
                console.error('Error:', error);
                showNotification('Error al eliminar usuario: ' + error.message, 'error');
            }
        }

        // Ver datos del usuario
        function viewUserData(patientId) {
            // Abrir enlaces a microservicios en nuevas pestañas
            window.open(`http://${window.location.hostname}:5002/api/vitals-gps/${patientId}?hours=24`, '_blank');
            window.open(`http://${window.location.hostname}:5002/api/kpis-risk/${patientId}?days=7`, '_blank');
        }

        // Funciones auxiliares
        function getRoleClass(role) {
            switch(role) {
                case 'Usuario': return 'patient';
                case 'Administrador': return 'admin';
                default: return 'secondary';
            }
        }

        function formatRole(role) {
            switch(role) {
                case 'Usuario': return 'Usuario';
                case 'Administrador': return 'Administrador';
                default: return role || 'Sin rol';
            }
        }

        function formatGender(gender) {
            switch(gender) {
                case 'Masculino': return 'Masculino';
                case 'Femenino': return 'Femenino';
                case 'Prefiero no decirlo': return 'Prefiero no decirlo';
                case 'Otro': return 'Otro';
                default: return gender || 'No especificado';
            }
        }

        function formatDate(dateString) {
            if (!dateString) return 'No especificada';
            try {
                return new Date(dateString).toLocaleDateString('es-ES');
            } catch {
                return dateString;
            }
        }

        function showNotification(message, type = 'info') {
            const toast = document.getElementById('notificationToast');
            const title = document.getElementById('toastTitle');
            const messageEl = document.getElementById('toastMessage');

            title.textContent = type === 'success' ? 'Éxito' : type === 'error' ? 'Error' : 'Información';
            messageEl.textContent = message;

            // Cambiar colores según el tipo
            toast.className = `toast ${type === 'success' ? 'bg-success text-white' : type === 'error' ? 'bg-danger text-white' : ''}`;

            const bsToast = new bootstrap.Toast(toast);
            bsToast.show();
        }

        // Generar UUID para nuevos usuarios
        function generateUUID() {
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                const r = Math.random() * 16 | 0;
                const v = c === 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
        }

        // Cerrar sesión
        function cerrarSesion() {
            if (confirm('¿Estás seguro de que quieres cerrar sesión?')) {
                // Limpiar datos locales si los hay
                localStorage.removeItem('adminSession');
                sessionStorage.clear();
                
                // Mostrar notificación
                showNotification('Sesión cerrada exitosamente', 'success');
                
                // Redirigir a la página de login o inicio
                setTimeout(() => {
                    // Puedes cambiar esta URL por la que prefieras
                    window.location.href = `http://${window.location.hostname}:5003/`;
                }, 1500);
            }
        }
	</script>
</body>
</html>
